<tool id="NEW_ML" name="NEW_ML" version="0.1.0" python_template_version="3.5">
    <requirements>
      <requirement type="package" version="2.2">matplotlib</requirement>
      <requirement type="package" version="1.2.1">scipy</requirement>
      <requirement type="package" version="2.7">python</requirement>
      <requirement type="package" version="0.24.2">pandas</requirement>
      <requirement type="package" version="0.20.0">scikit-learn</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[

        python '$__tool_directory__/ML.py' $Algo_select.MLAlgo

              --TrainFile '$input1' 

              --OutFile '$output1'

              --htmlFname '$output2'

              --htmlOutDir '$output2.extra_files_path'

              --SelectedSclaer '$Scalling_option'

              #if $TestMethod.TestMethod_selector == 'External'
                  --TestMethod '$TestMethod.TestMethod_selector'
                  --TestFile '$TestMethod.input2'
              #end if

              #if $TestMethod.TestMethod_selector == 'predict'
                  --TestMethod '$TestMethod.TestMethod_selector'
                  --TestFile '$TestMethod.input2'
              #end if

              #if $TestMethod.TestMethod_selector == 'Internal'
                  --TestMethod '$TestMethod.TestMethod_selector'
                  --NFolds '$TestMethod.nFolds'
              #end if

              #if $TestMethod.TestMethod_selector == 'TestSplit'
                  --TestMethod '$TestMethod.TestMethod_selector'
                  --Testspt $TestMethod.TestSplit
              #end if

    ]]></command>

    <inputs>

      <conditional name="Algo_select">
     
        <param name="MLAlgo" type="select" label="MLAlgo" argument="">
          <option value="SVMC">SVMC</option>
          <option value="SGDC">SGDC</option>
          <option value="DTC">DTC</option>
          <option value="GBC">GBC</option>
          <option value="RFC">RFC</option>
          <option value="LRC">LRC</option>
          <option value="KNC">KNC</option>
          <option value="GNBC">GNBC</option>
        </param>

        <when value= 'SVMC'>
          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">Program defaults.</option>
                <option value="advanced">Full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">
              <param name="C" type="float" label="Regularization" value="1.0" help="(--C)" />
              <param name="kernel" type="select" label="kernel" argument="--kernel">
                <option value="linear">linear</option>
                <option value="poly">poly</option>
                <option value="rbf">rbf</option>
                <option value="sigmoid">sigmoid</option>
                <option value="precomputed">precomputed</option>
              </param>
              <param name="coef0" type="float" label="" value="0.0" help="--coef0"/>
              <param name="shrinking" type="boolean" help="--shrinking"/>
              <param name="probability" type="boolean" help="--probability" />
              <param name="tol" type="float" value="0.001" help="--tol" />
              <param name="cache_size" type="integer" value="200" help="--cache_size" />
              <param name="class_weight" type="text" value="balanced" help="--class_weight" />
              <param name="verbose" type="boolean"  help="--verbose" />
              <param name="max_iter" type="integer" value="-1" help="--max_iter" />
              <param name="decision_function_shape" type="select" label="decision_function_shape" argument="--decision_function_shape">
                <option value="ovo">ovo</option>
                <option value="ovr">ovr</option>
              </param>
              <param name="randomState" type="integer" value="10" />
              <param name="breakties" type="boolean" help="--breakties" />
            </when>
          </conditional>
        </when>

        <when value= 'SGDC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">

              <param name="loss" type="select" label="loss" argument="--loss">
                <option value="hinge">hinge</option>
                <option value="log">log</option>
                <option value="modified_huber">modified_huber</option>
                <option value="squared_hinge">squared_hinge</option>
                <option value="perceptron">perceptron</option>
              </param>

              <param name="penalty" type="select" label="penalty" argument="--penalty">
                <option value="l2">l2</option>
                <option value="l1">log</option>
                <option value="elasticnet">elasticnet</option>
              </param>

              <param name="alpha" type="float" label="alpha" value="0.0001" help="--alpha"/>
              <param name="l1_ratio" type="float" value="0.15" help="--l1_ratio"/>
              <param name="fit_intercept" type="boolean" help="--fit_intercept" />
              <param name="max_iter" type="integer" value="1000" help="--max_iter" />
              <param name="tol" type="float" value="0.001" help="--tol" />
              <param name="shuffle" type="boolean" help="--shuffle" />
              <param name="verbose" type="integer"  value="0" help="--verbose" />
              <param name="epsilon" type="float" value="0.1" help="--epsilon" />
              <param name="n_jobs" type="integer" label="n_jobs" value='-1' argument="--n_jobs" />
              <param name="randomState" type="integer" value="10" />
              <param name="learning_rate" type="select" label="learning_rate" argument="--learning_rate">
                <option value="constant">constant</option>
                <option value="optimal">optimal</option>
                <option value="invscaling">invscaling</option>
                <option value="adaptive">adaptive</option>
              </param>
             <param  name="eta0" type="float" value="0.0" help="--eta0" />
             <param name="power_t" type="float" value="0.5" />
             <param name="early_stopping" type="boolean" help="--early_stopping" />
             <param name="validation_fraction" type="float" value='0.1' help="--validation_fraction" />
             <param name="n_iter_no_change" type="float" value="0.1" help="--n_iter_no_change" />
             <param name="class_weight" type="select" label="class_weight" argument="--class_weight">
                <option value="weight">weight</option>
                <option value="balanced">balanced</option>
              </param>
            <param name="warm_start" type="boolean" help="--warm_start" />
            <param name="average" type="boolean" help="--average" />

            </when>
          </conditional>
        </when>

        <when value= 'DTC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>
            <when value="advanced">
              <param name="criterion" type="select" label="criterion" argument="--criterion">
                <option value="gini">gini</option>
                <option value="entropy">entropy</option>
              </param>
              <param name="splitter" type="select" label="splitter" argument="--splitter">
                <option value="best">best</option>
                <option value="random">random</option>
              </param>
              <param name="max_depth" type="integer"  value="5" help="--max_depth" />
              <param name="min_samples_split" type="integer" value="2" help="--min_samples_split" />
              <param name="min_samples_leaf" type='integer' value="1" help="--min_samples_leaf" />
              <param name="min_weight_fraction_leaf" type='float' value='0.1' help="--min_weight_fraction_leaf" />
              <param name="random_state" type='integer' value='10' help="--random_state" />
              <param name="max_leaf_nodes" type='integer' value='10' help='--max_leaf_nodes' />
              <param name="min_impurity_decrease" type='float' value="0.1" help='--min_impurity_decrease' />
              <param name="min_impurity_split" type="float" value="0.1" help="--min_impurity_split" />
              <param name="class_weight" type="text" value="balanced" help="--class_weight" />
              <param name="ccp_alpha" type="float" value="0.1" help="--ccp_alpha" />

            </when>
          </conditional>
        </when>

        <when value= 'GBC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">
              <param name="loss" type="select" label="loss" argument="--loss">
                <option value="deviance">deviance</option>
                <option value="exponential">exponential</option>
              </param>
              <param name="learning_rate" type="float" value="0.1" help="--learning_rate" />
              <param name="n_estimators" type="integer" value="100" help="--n_estimators" />
              <param name="subsample"  type="float" value="1.0" help="--subsample" />
              <param name="criterion" type="select" label="criterion" argument="--criterion">
                <option value="friedman_mse">friedman_mse</option>
                <option value="mse">mse</option>
                <option value="mae">mae</option>
              </param>
              <param name="min_samples_split" type="float" value="5.0" argument="--min_samples_split" />
              <param name="min_samples_leaf" type="float" value="5.0" argument="--min_samples_leaf" />
              <param name="min_weight_fraction_leaf" type="float" value="0.0" help="--min_weight_fraction_leaf" />
              <param name="max_depth" type="integer" value="3" help="--max_depth" />
              <param name="min_impurity_decrease" type="float" value="0.0" help="--min_impurity_decrease" />
              <param name="min_impurity_split" type="float" value="0.00000007" help="--min_impurity_split" />
              <param name="init" type="text" value="zero" help="--init" />
              <param name="random_state" type='integer' value='10' help="--random_state" />
              <param name="verbose" type="integer" value="0" help="--verbose" />
              <param name="max_leaf_nodes" type="integer" value="0" help="--max_leaf_nodes" />
              <param name="warm_start" type="boolean" help="--warm_start" />
              <param name="validation_fraction" type="float" value="0.1" help="--validation_fraction" />
              <param name="n_iter_no_change" type="integer" value="10" help="--n_iter_no_change" />
              <param name="tol" type="float" value="0.00001" help="--tol" />
              <param name="ccp_alpha" type="float" value="0.0" help="--ccp_alpha" />

            </when>
          </conditional>
        </when>


        <when value= 'RFC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">

              <param name="n_estimators" type="integer" value="100" help="--n_estimators" />
              <param name="criterion" type="select" label="criterion" argument="--criterion">
                <option value="gini">gini</option>
                <option value="entropy">entropy</option>
              </param>

              <param name="max_depth" type="integer" label="max_depth" value="0" help="--max_depth" />
              <param name="min_samples_split" type="float" value="2.0" help="--min_samples_split" />
              <param name="min_samples_leaf" type="float" value="1.0" help="--min_samples_leaf" />
              <param name="min_weight_fraction_leaf" type="float" value="0.1" help="--min_weight_fraction_leaf" />
              <param name="max_leaf_nodes" type="integer" value="0" help="--max_leaf_nodes" />
              <param name="min_impurity_decrease" type="float" value="0.0" help="--min_impurity_decrease" />
              <param name="bootstrap" type="boolean" help="--bootstrap" />
              <param name="oob_score" type="boolean" help="--oob_score" /> 
              <param name="n_jobs" type="integer" value="-1" help="--n_jobs" />
              <param name="random_state" type="integer" value='10' help="--random_state" />
              <param name="verbose" type="integer" value="0" help="--verbose" />
              <param name="warm_start" type="boolean" help="--warm_start" />
              <param name="ccp_alpha" type="float" value="0.0" help="--ccp_alpha" />
              <param name="max_samples" type="float" value="0.0" help="--max_samples" />

            </when>
          </conditional>
        </when>

        <when value= 'LRC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">

              <param name="penalty" type="select" label="penalty" argument="--penalty">
                <option value="l1">l1</option>
                <option value="l2">l2</option>
              </param>

              <param name="dual" type="boolean" label="dual" argument="--dual" />
              <param name="tol" type="float" value="0.0004" argument="--tol" />
              <param name="C"   type="float" value="1.0"    help="--C" />
              <param name="fit_intercept" type="boolean" help="--fit_intercept" />
              <param name="intercept_scaling" type="float" value="0.0" help="--intercept_scaling" />
              <param name="random_state" type="integer" value="1" help="--random_state" />

              <param name="solver" type='select' label="solver" help="--solver" >
                <option value="newton-cg">newton-cg</option>
                <option value="lbfgs">lbfgs</option>
                <option value="liblinear">liblinear</option>
                <option value="sag">sag</option>
                <option value="saga">saga</option>
              </param>
              <param name="max_iter" type="integer" value="100" help="--max_inte" />

            </when>
          </conditional>
        </when>

        <when value= 'KNC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">
              <param name="nFolds" type="integer" label="nFolds" value="5" min="5" max="10" help="(-X)" />
            </when>
          </conditional>
        </when>

        <when value= 'GNBC'>

          <conditional name="settings">
            <param name="advanced" type="select" label="Hyper Perameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>

            <when value="simple">
            </when>

            <when value="advanced">
              <param name="nFolds" type="integer" label="Mask" value="5" min="5" max="10" help="(-X)" />
            </when>
          </conditional>
        </when>

      </conditional>

      <param name="input1" type="data" format="tsv" argument= "--TrainFile"/>

      <param name="Scalling_option" type="select" label="Scalling data" argument="--SelectedSclaer">
        <option value="Min_Max">Min_Max</option>
        <option value="Standard_Scaler">Standard_Scaler</option>
        <option value="No_Scaler">No_Scaler</option>
      </param>

      <conditional name="TestMethod">
        <param name="TestMethod_selector" type="select" label="Choose the Test method" argument="--TestMethod">
          <option value="Internal">Internal</option>
          <option value="TestSplit">TestSplit</option>
          <option value="External">External</option>
          <option value="Predict">Predict</option>
        </param>

        <when value="Internal">
            <param name="nFolds" type="integer" label="Mask" value="5" min="5" max="10" help="(-X)" />
        </when>
        <when value="TestSplit">
            <param name="TestSplit" type="float" label="Mask" value="0.2" min="0.0" max="1.0" help="(-X)" />
        </when>
        <when value="External">
            <param name="input2" type="data" format="tsv"  argument="--TestFile"/>
        </when>
        <when value="Predict">
            <param name="input2" type="data" format="tsv" argument="--TestFile"/>
        </when>
      </conditional>

    </inputs>


    <outputs>
        <data name='output1' format='tsv' label="out.tsv" />    
        <data name='output2' format='html' label="repot.html" />
    </outputs>
 

    <tests>
        <test>
            <param name="input1" value="1.csv"/>
            <output name="output1" file="out.csv" />
        </test>
    </tests>


    <help><![CDATA[
        usage: ML_algo.py [-h] -f FILE_NAME [-n N_FOLDS] [-w WORK_DIR_PATH] -o
                  OUT_FILE_NAME
optional arguments:
  -h, --help            show this help message and exit
  -f FILE_NAME, --file_name FILE_NAME
                        Path to target CSV file
  -n N_FOLDS, --n_folds N_FOLDS
                        n_folds for Cross Validation
  -w WORK_DIR_PATH, --Work_dir_path WORK_DIR_PATH
                        n_folds for Cross Validation
  -o OUT_FILE_NAME, --out_file_name OUT_FILE_NAME
                        Path to out file
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubseqtk,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {seqtk},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/lh3/seqtk},

}</citation>
    </citations>
</tool>